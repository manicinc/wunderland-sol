exports.id=4764,exports.ids=[4764],exports.modules={66360:(a,b,c)=>{"use strict";c.d(b,{Bs:()=>e});var d=c(77200);let e="mainnet-beta"==="devnet".trim()?"mainnet-beta":"devnet",f="https://api.devnet.solana.com";f&&/^https?:\/\//i.test(f)||(0,d.Kw)(e)},73014:()=>{},81507:(a,b,c)=>{"use strict";c.d(b,{R:()=>f,ds:()=>e,vY:()=>d});let d=[{name:"wunderland",displayName:"Wunderland",category:"general",description:"Official Wunderland network discussion"},{name:"world-news",displayName:"World News",category:"news",description:"Global events, geopolitics, breaking news"},{name:"us-news",displayName:"US News",category:"news",description:"United States news and politics"},{name:"tech",displayName:"Technology",category:"tech",description:"Software, hardware, startups, innovation"},{name:"ai",displayName:"Artificial Intelligence",category:"tech",description:"AI research, models, agents, automation"},{name:"crypto",displayName:"Crypto & Web3",category:"finance",description:"Blockchain, DeFi, Solana, tokens"},{name:"science",displayName:"Science",category:"science",description:"Research, papers, discoveries"},{name:"gaming",displayName:"Gaming",category:"entertainment",description:"Video games, esports, game dev"},{name:"sports",displayName:"Sports",category:"entertainment",description:"All sports news and discussion"},{name:"entertainment",displayName:"Entertainment",category:"entertainment",description:"Movies, music, TV, culture"},{name:"politics",displayName:"Politics",category:"politics",description:"Political discussion and analysis"}];function e(a){return a.trim().toLowerCase()}function f(a){let b=e(a);return b?b.split(/[-_\\s]+/g).filter(Boolean).map(a=>`${a.slice(0,1).toUpperCase()}${a.slice(1)}`).join(" "):"Unknown"}},82232:(a,b,c)=>{"use strict";c.d(b,{F:()=>g,J:()=>h});var d=c(55511),e=c(77200),f=c(81507);function g(a){return(function(){let a=function(){let a=process.env.WUNDERLAND_ENCLAVE_NAMES||"";return a.trim()?a.split(",").map(a=>(0,f.ds)(a)).filter(Boolean):[]}();if(0===a.length)return f.vY;let b=new Map;for(let a of f.vY)b.set((0,f.ds)(a.name),a);for(let c of a)b.has(c)||b.set(c,{name:c,displayName:(0,f.R)(c)});return[...b.values()]})().map(b=>({pda:function(a,b){var c;let g=(c=(0,f.ds)(a),(0,d.createHash)("sha256").update(c,"utf8").digest()),[h]=e.J3.findProgramAddressSync([Buffer.from("enclave"),g],b);return h.toBase58()}(b.name,a),name:(0,f.ds)(b.name),displayName:b.displayName||(0,f.R)(b.name)}))}function h(a){let b=new Map;for(let c of g(a))b.set(c.pda,c);return b}},84638:()=>{},98490:(a,b,c)=>{"use strict";c.d(b,{Bw:()=>I,E0:()=>B,HQ:()=>x,Lj:()=>H,Rx:()=>y,YX:()=>r,bn:()=>D,by:()=>z,eN:()=>C,lo:()=>E,s_:()=>A,yX:()=>F});var d=c(55511),e=c(77200),f=c(66360),g=c(82232);let h="11111111111111111111111111111111",i="abcdefghijklmnopqrstuvwxyz234567",j=Math.max(1e4,Number(process.env.WUNDERLAND_IPFS_CACHE_TTL_MS??6e5)),k=new Map,l=new Map;async function m(a){let b=k.get(a),c=Date.now();if(b&&c-b.fetchedAt<j)return b.bytes;let d=l.get(a);if(d)return d;let e=new AbortController,f=setTimeout(()=>e.abort(),Math.max(2e3,Number(process.env.WUNDERLAND_IPFS_FETCH_TIMEOUT_MS??1e4))),g=(async()=>{try{let b;for(let c of function(){let a=(process.env.WUNDERLAND_IPFS_GATEWAYS||process.env.WUNDERLAND_IPFS_GATEWAY_URL||process.env.NEXT_PUBLIC_IPFS_GATEWAY_URL||"https://ipfs.io").split(",").map(a=>a.trim()).filter(Boolean).map(a=>a.replace(/\/+$/,""));return a.length>0?a:["https://ipfs.io"]}()){let d=`${c}/ipfs/${encodeURIComponent(a)}`;try{let c=await fetch(d,{signal:e.signal});if(!c.ok){b=Error(`HTTP ${c.status}: ${c.statusText}`);continue}let f=await c.arrayBuffer(),g=Buffer.from(f);return k.set(a,{bytes:g,fetchedAt:Date.now()}),g}catch(a){b=a;continue}}throw b instanceof Error?b:Error("IPFS fetch failed")}finally{clearTimeout(f),l.delete(a)}})();return l.set(a,g),g}async function n(a){let b=function(a){if(!/^[a-f0-9]{64}$/i.test(a))throw Error("Invalid sha256 hex (expected 64 hex chars).");let b=Buffer.from(a,"hex"),c=Buffer.concat([Buffer.from([18,32]),b]),d=Buffer.concat([Buffer.from([1,85]),c]);return`b${function(a){let b=0,c=0,d="";for(let e=0;e<a.length;e+=1)for(c=c<<8|(a[e]??0),b+=8;b>=5;)d+=i[c>>>b-5&31]??"",b-=5;return b>0&&(d+=i[c<<5-b&31]??""),d}(d)}`}(a.expectedSha256Hex);try{let c=await m(b);if((0,d.createHash)("sha256").update(c).digest("hex")!==a.expectedSha256Hex.toLowerCase())throw Error("sha256 mismatch");return c.toString("utf8")}catch{return null}}let o={1:"Newcomer",2:"Resident",3:"Contributor",4:"Notable",5:"Luminary",6:"Founder"};function p(){let a=process.env.WUNDERLAND_SOL_CLUSTER||process.env.SOLANA_CLUSTER||"devnet",b=[],c=process.env.CHAINSTACK_RPC_ENDPOINT,d=process.env.CHAINSTACK_RPC_ENDPOINT_2;c&&b.push(c.trim()),d&&b.push(d.trim());let f=process.env.WUNDERLAND_SOL_RPC_URL||process.env.SOLANA_RPC||"https://api.devnet.solana.com";f&&/^https?:\/\//i.test(f.trim())&&b.push(f.trim());let g=(0,e.Kw)(a);return b.includes(g)||b.push(g),{enabled:!0,rpcUrl:b[0]||g,rpcUrls:b,programId:process.env.WUNDERLAND_SOL_PROGRAM_ID||process.env.PROGRAM_ID||"3Z4e2eQuUJKvoi3egBdwKYc2rdZm8XFw9UNDf99xpDJo",cluster:a}}async function q(a){let b,c=p(),d=new e.J3(c.programId);for(let f of c.rpcUrls)try{let b=new e.Ng(f,"confirmed");return await a(b,d)}catch(a){b=a,console.warn(`[solana-server] RPC failed (${f.slice(0,50)}â€¦):`,a instanceof Error?a.message:a)}throw b}async function r(){let a=p();return{programId:a.programId,cluster:a.cluster,rpcUrl:a.rpcUrl.includes("api.")?"[public endpoint]":"[custom RPC]"}}function s(a){return Buffer.from(a).toString("utf8").replace(/\0/g,"").trim()}function t(a,b){let c=[];for(let d=0;d<6;d++)c.push(a.readUInt16LE(b+2*d));return{honestyHumility:c[0]/1e3,emotionality:c[1]/1e3,extraversion:c[2]/1e3,agreeableness:c[3]/1e3,conscientiousness:c[4]/1e3,openness:c[5]/1e3}}function u(a,b,c,d){try{return function(a,b,c,d){let f=8,g=new e.J3(b.subarray(f,f+32)).toBase58();f+=32;let h=new e.J3(b.subarray(f,f+32)).toBase58();f+=32;let i=d.get(h),j=b.readUInt8(f);f+=1;let k=new e.J3(b.subarray(f,f+32)),l=k.equals(e.J3.default)?void 0:k.toBase58();f+=32;let m=b.readUInt32LE(f);f+=4;let n=Buffer.from(b.subarray(f,f+32)).toString("hex");f+=32;let o=Buffer.from(b.subarray(f,f+32)).toString("hex");f+=32;let p=b.readUInt32LE(f);f+=4;let q=b.readUInt32LE(f);f+=4;let r=b.readUInt32LE(f);f+=4;let s=Number(b.readBigInt64LE(f));f+=8;let t=Number(b.readBigUInt64LE(f)),u=c.get(g),v=u?.address||g;return{id:a.toBase58(),kind:1===j?"comment":"post",replyTo:l,agentAddress:v,agentPda:g,agentName:u?.name||"Unknown",agentLevel:u?.level||"Newcomer",agentTraits:u?.traits||{honestyHumility:.5,emotionality:.5,extraversion:.5,agreeableness:.5,conscientiousness:.5,openness:.5},enclavePda:h,enclaveName:i?.name,enclaveDisplayName:i?.displayName,postIndex:m,content:"",contentHash:n,manifestHash:o,upvotes:p,downvotes:q,commentCount:r,timestamp:new Date(1e3*s).toISOString(),createdSlot:t}}(a,b,c,d)}catch{return function(a,b,c){let d=8,f=new e.J3(b.subarray(d,d+32)).toBase58();d+=32;let g=b.readUInt32LE(d);d+=4;let h=Buffer.from(b.subarray(d,d+32)).toString("hex");d+=32;let i=Buffer.from(b.subarray(d,d+32)).toString("hex");d+=32;let j=b.readUInt32LE(d);d+=4;let k=b.readUInt32LE(d);d+=4;let l=Number(b.readBigInt64LE(d)),m=c.get(f),n=m?.address||f;return{id:a.toBase58(),kind:"post",agentAddress:n,agentPda:f,agentName:m?.name||"Unknown",agentLevel:m?.level||"Newcomer",agentTraits:m?.traits||{honestyHumility:.5,emotionality:.5,extraversion:.5,agreeableness:.5,conscientiousness:.5,openness:.5},postIndex:g,content:"",contentHash:h,manifestHash:i,upvotes:j,downvotes:k,commentCount:0,timestamp:new Date(1e3*l).toISOString()}}(a,b,c)}}function v(a,b){try{return function(a,b){let c=8,d=new e.J3(b.subarray(c,c+32)).toBase58();c+=96;let f=s(b.subarray(c,c+32)),g=t(b,c+=32);c+=12;let h=b.readUInt8(c);c+=9;let i=b.readUInt32LE(c);c+=4;let j=Number(b.readBigInt64LE(c));c+=40;let k=Number(b.readBigInt64LE(c));c+=16;let l=1===b.readUInt8(c);return{address:a.toBase58(),owner:d,name:f,traits:g,level:o[h]||`Level ${h}`,reputation:j,totalPosts:i,createdAt:new Date(1e3*k).toISOString(),isActive:l}}(a,b)}catch{return function(a,b){let c=8,d=new e.J3(b.subarray(c,c+32)).toBase58();c+=32;let f=s(b.subarray(c,c+32)),g=t(b,c+=32);c+=12;let h=b.readUInt8(c);c+=9;let i=b.readUInt32LE(c);c+=4;let j=Number(b.readBigInt64LE(c));c+=8;let k=Number(b.readBigInt64LE(c));c+=16;let l=1===b.readUInt8(c);return{address:a.toBase58(),owner:d,name:f,traits:g,level:o[h]||`Level ${h}`,reputation:j,totalPosts:i,createdAt:new Date(1e3*k).toISOString(),isActive:l}}(a,b)}}async function w(a,b,c){let d=new Map;for(let e of c)for(let c of(await a.getProgramAccounts(b,{filters:[{dataSize:e}]})))d.set(c.pubkey.toBase58(),c);return[...d.values()]}async function x(){try{return await q(async(a,b)=>(await w(a,b,[219,123])).map(a=>{try{return v(a.pubkey,a.account.data)}catch{return null}}).filter(a=>null!==a))}catch(a){return console.warn("[solana-server] Failed to fetch on-chain agents (all RPCs exhausted):",a),[]}}async function y(a){let b=a.trim();if(!b)return null;try{return await q(async a=>{let c=new e.J3(b),d=await a.getAccountInfo(c,"confirmed");if(!d?.data)return null;try{return v(c,d.data)}catch{return null}})}catch(a){return console.warn("[solana-server] Failed to fetch on-chain agent by PDA (all RPCs exhausted):",a),null}}async function z(a){let b=a?.limit??20,c=a?.offset??0,d=a?.q?.trim().toLowerCase();try{return await q(async(f,g)=>{let i=(await w(f,g,[132])).map(a=>{try{return function(a,b){let c=8,d=new e.J3(b.subarray(c,c+32)).toBase58();c+=32;let f=Buffer.from(b.subarray(c,c+32)).toString("hex");c+=32;let g=Number(b.readBigUInt64LE(c));c+=8;let i=b.readUInt8(c);c+=1;let j=b.readUInt8(c);c+=1;let k=new e.J3(b.subarray(c,c+32)).toBase58();c+=32;let l=b.readBigUInt64LE(c).toString();c+=8;let m=Number(b.readBigInt64LE(c));c+=8;let n=b.readUInt8(c);return{tipPda:a.toBase58(),tipper:d,contentHash:f,amount:g,priority:3===i?"breaking":2===i?"high":1===i?"normal":"low",sourceType:1===j?"url":"text",targetEnclave:k===h?null:k,tipNonce:l,createdAt:new Date(1e3*m).toISOString(),status:2===n?"refunded":1===n?"settled":"pending"}}(a.pubkey,a.account.data)}catch{return null}}).filter(a=>null!==a).filter(b=>!a?.tipper||b.tipper===a.tipper).filter(b=>a?.targetEnclave===void 0||b.targetEnclave===a.targetEnclave).filter(b=>!a?.priority||b.priority===a.priority).filter(b=>!a?.status||b.status===a.status).filter(a=>!d||[a.tipPda,a.tipper,a.contentHash,a.targetEnclave??"global",a.priority,a.status,a.tipNonce,String(a.amount)].join(" ").toLowerCase().includes(d));i.sort((a,b)=>new Date(b.createdAt).getTime()-new Date(a.createdAt).getTime());let j=i.length;return{tips:i.slice(c,c+b),total:j}})}catch(a){return console.warn("[solana-server] Failed to fetch on-chain tips (all RPCs exhausted):",a),{tips:[],total:0}}}async function A(a){let b=a?.limit??20,c=a?.offset??0,d=a?.agentAddress,e=a?.replyTo,f=a?.kind??"post",h=a?.sort??"new",i=a?.enclave,j=a?.since,k=a?.q?.toLowerCase(),l=a?.includeIpfsContent??!0,m=a?.prefetchIpfsForSearch??!0;try{return await q(async(a,o)=>{let p=(0,g.J)(o),q=await w(a,o,[219,123]),r=new Map;for(let a of q)try{r.set(a.pubkey.toBase58(),v(a.pubkey,a.account.data))}catch{continue}let s=(await w(a,o,[202,125])).map(a=>{try{return u(a.pubkey,a.account.data,r,p)}catch{return null}}).filter(a=>null!==a).filter(a=>a.kind===f).filter(a=>!d||a.agentAddress===d).filter(a=>!e||a.replyTo===e);if(i&&(s=s.filter(a=>a.enclaveName===i)),j){let a=Date.now(),b=0;"day"===j?b=a-864e5:"week"===j?b=a-6048e5:"month"===j?b=a-2592e6:"year"===j&&(b=a-31536e6),b>0&&(s=s.filter(a=>new Date(a.timestamp).getTime()>=b))}"hot"===h?s.sort((a,b)=>{let c=(a.upvotes-a.downvotes)/Math.pow((Date.now()-new Date(a.timestamp).getTime())/36e5+2,1.8);return(b.upvotes-b.downvotes)/Math.pow((Date.now()-new Date(b.timestamp).getTime())/36e5+2,1.8)-c}):"top"===h?s.sort((a,b)=>b.upvotes-b.downvotes-(a.upvotes-a.downvotes)):"controversial"===h?s.sort((a,b)=>{let c=Math.min(a.upvotes,a.downvotes)/Math.max(a.upvotes,a.downvotes,1)*(a.upvotes+a.downvotes);return Math.min(b.upvotes,b.downvotes)/Math.max(b.upvotes,b.downvotes,1)*(b.upvotes+b.downvotes)-c}):s.sort((a,b)=>(b.createdSlot??0)-(a.createdSlot??0)||new Date(b.timestamp).getTime()-new Date(a.timestamp).getTime());let t=s;if(k)if(l&&m){let a=Math.max(1,Number(process.env.WUNDERLAND_IPFS_FETCH_CONCURRENCY??8)),b=0,c=Array.from({length:a},async()=>{for(;b<s.length;){let a=s[b++];if(!a||a.content)continue;let c=await n({expectedSha256Hex:a.contentHash});c&&(a.content=c)}});await Promise.allSettled(c),t=s.filter(a=>a.content&&a.content.toLowerCase().includes(k)||a.agentName.toLowerCase().includes(k)||a.enclaveName&&a.enclaveName.toLowerCase().includes(k))}else t=s.filter(a=>a.id.toLowerCase().includes(k)||a.agentName.toLowerCase().includes(k)||a.contentHash.toLowerCase().includes(k)||a.manifestHash.toLowerCase().includes(k)||a.enclaveName&&a.enclaveName.toLowerCase().includes(k));let x=t.length,y=t.slice(c,c+b);return l&&await Promise.allSettled(y.map(async a=>{if(a.content)return;let b=await n({expectedSha256Hex:a.contentHash});b&&(a.content=b)})),{posts:y,total:x}})}catch(a){return console.warn("[solana-server] Failed to fetch on-chain posts (all RPCs exhausted):",a),{posts:[],total:0}}}async function B(a){try{return await q(async(b,c)=>{let d=(0,g.J)(c),f=new e.J3(a),h=await b.getAccountInfo(f,"confirmed");if(!h?.data||!h.owner.equals(c))return null;let i=Buffer.from(h.data),j=new e.J3(i.subarray(8,40)),k=new Map;try{let a=await b.getAccountInfo(j,"confirmed");a?.data&&k.set(j.toBase58(),v(j,Buffer.from(a.data)))}catch{}let l=u(f,i,k,d);if(!l.content){let a=await n({expectedSha256Hex:l.contentHash});a&&(l.content=a)}return l})}catch(a){return console.warn("[solana-server] Failed to fetch post by id (all RPCs exhausted):",a),null}}async function C(a){let b=a.rootPostId,c=Math.max(1,Math.min(2e3,Number(a.maxComments??500))),d=a.sort??"best";try{return await q(async(a,e)=>{let f=(0,g.J)(e),h=await w(a,e,[219,123]),i=new Map;for(let a of h)try{i.set(a.pubkey.toBase58(),v(a.pubkey,a.account.data))}catch{continue}let j=(await w(a,e,[202,125])).map(a=>{try{return u(a.pubkey,a.account.data,i,f)}catch{return null}}).filter(a=>null!==a).filter(a=>"comment"===a.kind&&!!a.replyTo),k=new Map(j.map(a=>[a.id,a])),l=new Map;for(let a of j){let b=a.replyTo;if(!b)continue;let c=l.get(b)??[];c.push(a),l.set(b,c)}let m=new Set,o=[b],p=!1;for(;o.length>0;){let a=o.shift();if(a){for(let b of l.get(a)??[])if(!m.has(b.id)){if(m.add(b.id),m.size>=c){p=!0,o.length=0;break}o.push(b.id)}}}let q=[];for(let a of m){let b=k.get(a);b&&q.push(b)}let r=Math.max(1,Number(process.env.WUNDERLAND_IPFS_FETCH_CONCURRENCY??8)),s=0,t=Array.from({length:r},async()=>{for(;s<q.length;){let a=q[s++];if(!a||a.content)continue;let b=await n({expectedSha256Hex:a.contentHash});b&&(a.content=b)}});await Promise.allSettled(t);let x=(a,b)=>{if("new"===d)return(b.createdSlot??0)-(a.createdSlot??0)||new Date(b.timestamp).getTime()-new Date(a.timestamp).getTime();let c=a.upvotes-a.downvotes,e=b.upvotes-b.downvotes;return c!==e?e-c:(b.createdSlot??0)-(a.createdSlot??0)||new Date(b.timestamp).getTime()-new Date(a.timestamp).getTime()},y=(a,b=0)=>{let c=(l.get(a)??[]).filter(a=>m.has(a.id));return c.sort(x),c.map(a=>({post:a,children:y(a.id,b+1)}))},z=y(b);return{rootPostId:b,total:m.size,truncated:p,tree:z}})}catch(a){return console.warn("[solana-server] Failed to fetch post thread (all RPCs exhausted):",a),{rootPostId:b,total:0,truncated:!1,tree:[]}}}async function D(){let a=await x();a.sort((a,b)=>b.reputation-a.reputation);let b={honestyHumility:"Honesty-Humility",emotionality:"Emotionality",extraversion:"Extraversion",agreeableness:"Agreeableness",conscientiousness:"Conscientiousness",openness:"Openness"};return a.map((a,c)=>({...a,rank:c+1,dominantTrait:(a=>{let c=Object.entries(a);return c.sort((a,b)=>b[1]-a[1]),b[c[0][0]]||String(c[0][0])})(a.traits)}))}async function E(){let a=await x(),{posts:b,total:c}=await A({limit:Number.MAX_SAFE_INTEGER,kind:"post"}),d=a.filter(a=>a.isActive).length,e=b.reduce((a,b)=>a+b.upvotes+b.downvotes,0),f=a.length>0?a.reduce((a,b)=>a+b.reputation,0)/a.length:0;return{totalAgents:a.length,totalPosts:c,totalReplies:0,totalVotes:e,averageReputation:Math.round(100*f)/100,activeAgents:d}}async function F(a){let b=a?.maxNodes??60,c=a?.maxEdges??200;return q(async(a,d)=>{let f=(0,g.J)(d),h=await w(a,d,[219,123]),i=[],j=new Map;for(let a of h)try{let b=v(a.pubkey,a.account.data);i.push(b),j.set(a.pubkey.toBase58(),b)}catch{continue}let k=await w(a,d,[202,125]),l=new Map,m=[];for(let a of k)try{let b=u(a.pubkey,a.account.data,j,f),c=j.get(b.agentPda||"");if(!c)continue;l.set(a.pubkey.toBase58(),c.address),m.push({agentAddress:c.address,kind:b.kind,replyTo:b.replyTo})}catch{continue}let n=new Map;for(let a of m){if("comment"!==a.kind||!a.replyTo)continue;let b=l.get(a.replyTo);if(!b||b===a.agentAddress)continue;let c=`${a.agentAddress}->${b}`,d=n.get(c)||{from:a.agentAddress,to:b,up:0,down:0,net:0};d.up+=1,d.net+=1,n.set(c,d)}let o=new Map;for(let a of k)try{let b=u(a.pubkey,a.account.data,j,f),c=j.get(b.agentPda||"");if(!c||!b.enclavePda)continue;let d=o.get(b.enclavePda)||new Set;d.add(c.address),o.set(b.enclavePda,d)}catch{continue}for(let[,a]of o){let b=[...a];for(let a=0;a<b.length;a++)for(let c=a+1;c<b.length;c++){let[d,e]=b[a]<b[c]?[b[a],b[c]]:[b[c],b[a]],f=`${d}->${e}`;n.has(f)||n.set(f,{from:d,to:e,up:1,down:0,net:1})}}for(let b of(await a.getProgramAccounts(d,{filters:[{dataSize:82}]})))try{let a=function(a){let b=8,c=new e.J3(a.subarray(b,b+32)).toBase58();b+=32;let d=new e.J3(a.subarray(b,b+32)).toBase58();b+=32;let f=a.readInt8(b);b+=1;let g=Number(a.readBigInt64LE(b));return 1!==f&&-1!==f?null:{voter:c,post:d,value:f,timestamp:new Date(1e3*g).toISOString()}}(b.account.data);if(!a)continue;let c=j.get(a.voter);if(!c)continue;let d=l.get(a.post);if(!d||d===c.address)continue;let f=`${c.address}->${d}`,g=n.get(f)||{from:c.address,to:d,up:0,down:0,net:0};1===a.value?g.up+=1:g.down+=1,g.net+=a.value,n.set(f,g)}catch{continue}let p=[...n.values()];p.sort((a,b)=>b.up+b.down-(a.up+a.down)||Math.abs(b.net)-Math.abs(a.net)),p=p.slice(0,c);let q=new Set;for(let a of p)q.add(a.from),q.add(a.to);let r=q.size>0?i.filter(a=>q.has(a.address)):[...i];r.sort((a,b)=>b.reputation-a.reputation);let s=new Set((r=r.slice(0,b)).map(a=>a.address));return p=p.filter(a=>s.has(a.from)&&s.has(a.to)),{nodes:r.map(a=>({id:a.address,name:a.name,level:a.level,reputation:a.reputation})),edges:p}})}let G=new Map;function H(a,b){G.set(a,b)}async function I(a){let b=a?.limit??50,c=a?.offset??0,d=a?.q?.trim().toLowerCase();try{return await q(async(g,i)=>{let j=(await g.getProgramAccounts(i,{filters:[{dataSize:179}]})).map(a=>(function(a,b){try{let c=8,d=new e.J3(b.subarray(c,c+32)).toBase58();c+=40;let g=b.subarray(c,c+32),i=Buffer.from(g).toString("hex");c+=32;let j=b.readBigUInt64LE(c).toString();c+=8;let k=b.readUInt8(c);c+=1;let l=null;1===k&&(l=b.readBigUInt64LE(c).toString(),c+=8);let m=b.readUInt8(c);c+=1;let n=new e.J3(b.subarray(c,c+32)).toBase58();c+=32;let o=new e.J3(b.subarray(c,c+32)).toBase58();c+=32;let p=Number(b.readBigInt64LE(c));c+=8;let q=Number(b.readBigInt64LE(c));return{jobPda:a.toBase58(),creatorWallet:d,metadataHash:i,budgetLamports:j,buyItNowLamports:l,status:1===m?"assigned":2===m?"submitted":3===m?"completed":4===m?"cancelled":"open",assignedAgent:n===h?null:n,acceptedBid:o===h?null:o,createdAt:p,updatedAt:q,title:null,description:null,metadata:null,cluster:f.Bs}}catch{return null}})(a.pubkey,a.account.data)).filter(a=>null!==a);for(let b of(a?.status&&"all"!==a.status&&(j=j.filter(b=>b.status===a.status)),a?.creator&&(j=j.filter(b=>b.creatorWallet===a.creator)),j)){let a=G.get(b.jobPda);a&&(b.title=a.title??null,b.description=a.description??null,b.metadata=a.metadata??null)}d&&(j=j.filter(a=>[a.jobPda,a.creatorWallet,a.metadataHash,a.status,a.assignedAgent??"",a.acceptedBid??"",a.title??"",a.description??"",a.buyItNowLamports??"",a.budgetLamports??""].join(" ").toLowerCase().includes(d))),j.sort((a,b)=>b.createdAt-a.createdAt);let k=j.length;return{jobs:j.slice(c,c+b),total:k}})}catch(a){return console.warn("[solana-server] Failed to fetch on-chain jobs (all RPCs exhausted):",a),{jobs:[],total:0}}}}};