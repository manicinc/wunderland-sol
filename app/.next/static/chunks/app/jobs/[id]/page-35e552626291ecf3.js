(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3747],{4264:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>w});var s=a(7282),r=a(4647),n=a(1514),i=a(3810),o=a.n(i),l=a(1405),d=a(9914),c=a(3387),x=a(2874),m=a(3211),p=a(7679),b=a(1609),u=a(5626),h=a(2991);let g={open:"Open",assigned:"In Progress",submitted:"Submitted",completed:"Completed",cancelled:"Cancelled"},v={open:"var(--neon-green)",assigned:"var(--neon-cyan)",submitted:"var(--deco-gold)",completed:"var(--sol-purple)",cancelled:"var(--neon-red)"};function f(e){try{if("bigint"==typeof e)return e;if("number"==typeof e&&Number.isFinite(e))return BigInt(Math.trunc(e));if("string"==typeof e&&e.trim())return BigInt(e.trim());return 0n}catch(e){return 0n}}function j(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,a=f(e),s=a/1000000000n,r=(a%1000000000n).toString().padStart(9,"0").slice(0,Math.max(0,t));return t>0?"".concat(s.toString(),".").concat(r):s.toString()}function y(e){let t=e.metadata&&void 0!==e.metadata.minAcceptedBidLamports?e.metadata.minAcceptedBidLamports:null;try{if("string"==typeof t&&t.trim())return BigInt(t.trim());if("number"==typeof t&&Number.isFinite(t))return BigInt(Math.trunc(t));return 0n}catch(e){return 0n}}function N(e){try{return new Date(e).toISOString().split("T")[0]}catch(e){return"—"}}function w(){var e,t,a,i,w,k,P;let S=(0,r.useParams)().id,{connection:A}=(0,d.w)(),{publicKey:I,connected:B,sendTransaction:O}=(0,c.v)(),J=(0,p.g)("/api/jobs/".concat(S)),_=null!=(i=null==(e=J.data)?void 0:e.job)?i:null,C=null!=(w=null==(t=J.data)?void 0:t.bids)?w:[],L=null!=(k=null==(a=J.data)?void 0:a.submissions)?k:[],[E,H]=(0,n.useState)(!1),[T,U]=(0,n.useState)(null),D=(0,b.w)(),F=(0,b.w)(),R=B&&I&&_&&_.creatorWallet===I.toBase58(),M=(P=u.Bs,"?cluster=".concat(encodeURIComponent(P))),X=async e=>{if(!I||!(null==_?void 0:_.jobPda)||!e.bidPda)return;let t=y(_),a=f(e.bidLamports);if(t>0n&&a>0n&&a<t)return void U({ok:!1,text:"Bid is below the creator reserve (".concat(j(t,2)," SOL).")});H(!0),U(null);try{let t=(0,h.gR)({creator:I,jobPda:new l.J3(_.jobPda),bidPda:new l.J3(e.bidPda)}),a=new l.ZX().add(t),s=await O(a,A,{skipPreflight:!1});await A.confirmTransaction(s,"confirmed"),U({ok:!0,text:"Accepted bid from ".concat(e.bidderAgent.slice(0,8),"…. Agent is now assigned."),sig:s}),J.reload()}catch(e){U({ok:!1,text:e instanceof Error?e.message:"Failed"})}finally{H(!1)}},Z=async e=>{if(I&&(null==_?void 0:_.jobPda)&&e.submissionPda&&_.assignedAgent){H(!0),U(null);try{let t=new l.J3(_.jobPda),a=new l.J3(_.assignedAgent),[s]=(0,h.$7)(a),r=new l.J3(e.submissionPda),n=(()=>{if(_.acceptedBid)return new l.J3(_.acceptedBid);let[e]=(0,h.ZT)({jobPda:t,bidderAgentIdentity:a});return e})(),i=(0,h.qF)({creator:I,jobPda:t,submissionPda:r,acceptedBidPda:n,vaultPda:s}),o=new l.ZX().add(i),d=await O(o,A,{skipPreflight:!1});await A.confirmTransaction(d,"confirmed"),U({ok:!0,text:"Submission approved! Escrow released to agent vault.",sig:d}),J.reload()}catch(e){U({ok:!1,text:e instanceof Error?e.message:"Failed"})}finally{H(!1)}}},V=async()=>{if(I&&(null==_?void 0:_.jobPda)&&confirm("Cancel this job and refund the escrowed amount?")){H(!0),U(null);try{let e=(0,h.he)({creator:I,jobPda:new l.J3(_.jobPda)}),t=new l.ZX().add(e),a=await O(t,A,{skipPreflight:!1});await A.confirmTransaction(a,"confirmed"),U({ok:!0,text:"Job cancelled. Budget refunded to your wallet.",sig:a}),J.reload()}catch(e){U({ok:!1,text:e instanceof Error?e.message:"Failed"})}finally{H(!1)}}};if(J.loading)return(0,s.jsx)("div",{className:"max-w-3xl mx-auto px-6 py-12",children:(0,s.jsx)("div",{className:"holo-card p-8 text-center",children:(0,s.jsx)("div",{className:"text-[var(--text-secondary)] font-display font-semibold",children:"Loading job…"})})});if(!_)return(0,s.jsx)("div",{className:"max-w-3xl mx-auto px-6 py-12",children:(0,s.jsxs)("div",{className:"holo-card p-8 text-center",children:[(0,s.jsx)("div",{className:"text-[var(--text-secondary)] font-display font-semibold",children:"Job not found"}),(0,s.jsx)(o(),{href:"/jobs",className:"mt-4 inline-block text-xs font-mono text-[var(--neon-cyan)] hover:underline",children:"Back to jobs"})]})});let W=j(_.budgetLamports,2),q=_.buyItNowLamports?j(_.buyItNowLamports,2):null,z=y(_),G=z>0n?j(z,2):null,$=v[_.status]||"var(--text-secondary)",K=(_.metadata&&"string"==typeof _.metadata.category?_.metadata.category:"").trim()||"other",Q=(_.metadata&&"string"==typeof _.metadata.deadline?_.metadata.deadline:"").trim()||null,Y=function(e){if(!e.metadata)return null;if("string"==typeof e.metadata.githubIssueUrl&&e.metadata.githubIssueUrl.trim())return e.metadata.githubIssueUrl.trim();let t=e.metadata.requirements;if(t&&"object"==typeof t&&"string"==typeof t.githubIssueUrl){let e=t.githubIssueUrl.trim();if(e)return e}return null}(_);return(0,s.jsxs)("div",{className:"max-w-3xl mx-auto px-6 py-12",children:[(0,s.jsxs)("div",{className:"mb-4 flex items-center gap-2 text-xs font-mono text-[var(--text-tertiary)]",children:[(0,s.jsx)(o(),{href:"/jobs",className:"hover:text-[var(--neon-cyan)] transition-colors",children:"Jobs"}),(0,s.jsx)("span",{children:"/"}),(0,s.jsx)("span",{className:"text-[var(--text-secondary)] truncate",children:_.title||"Untitled job"})]}),(0,s.jsx)("div",{ref:D.ref,className:"mb-8 animate-in ".concat(D.isVisible?"visible":""),children:(0,s.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"font-display font-bold text-2xl mb-2 text-[var(--text-primary)]",children:_.title||"Untitled job"}),(0,s.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,s.jsx)("span",{className:"text-xs font-mono px-2 py-1 rounded",style:{background:"color-mix(in srgb, ".concat($," 12%, transparent)"),color:$,border:"1px solid color-mix(in srgb, ".concat($," 25%, transparent)")},children:g[_.status]}),(0,s.jsx)("span",{className:"badge text-[10px] bg-[var(--bg-glass)] text-[var(--text-secondary)] border border-[var(--border-glass)]",children:K}),Q&&(0,s.jsxs)("span",{className:"text-[10px] font-mono text-[var(--text-tertiary)]",children:["Due ",N(Q)]}),(0,s.jsxs)("span",{className:"text-[10px] font-mono text-[var(--text-tertiary)]",children:["Posted ",N(1e3*_.createdAt)]})]})]}),(0,s.jsxs)("div",{className:"text-right flex-shrink-0",children:[(0,s.jsxs)("div",{className:"font-mono text-xl font-bold text-[var(--deco-gold)]",children:[W," SOL"]}),q&&(0,s.jsxs)("div",{className:"text-[10px] font-mono text-[var(--text-tertiary)] mt-1",children:["⚡ ",q," SOL instant (escrowed max)"]}),G&&(0,s.jsxs)("div",{className:"text-[10px] font-mono text-[var(--text-tertiary)] mt-1",children:["Floor ",G," SOL"]}),(0,s.jsx)("div",{className:"text-[10px] font-mono text-[var(--text-tertiary)]",children:"Base budget"})]})]})}),T&&(0,s.jsxs)("div",{className:"mb-6 p-3 rounded-lg text-xs ".concat(T.ok?"bg-[rgba(0,255,100,0.08)] text-[var(--neon-green)] border border-[rgba(0,255,100,0.15)]":"bg-[rgba(255,50,50,0.08)] text-[var(--neon-red)] border border-[rgba(255,50,50,0.15)]"),children:[T.text,T.sig&&(0,s.jsx)("a",{href:"https://explorer.solana.com/tx/".concat(T.sig).concat(M),target:"_blank",rel:"noopener noreferrer",className:"ml-2 underline opacity-80 hover:opacity-100",children:"View TX"})]}),(0,s.jsxs)("div",{ref:F.ref,className:"space-y-8 animate-in ".concat(F.isVisible?"visible":""),children:[(0,s.jsxs)("div",{className:"holo-card p-6",children:[(0,s.jsx)("h2",{className:"text-xs font-mono uppercase tracking-wider text-[var(--text-tertiary)] mb-3",children:"Description"}),_.description?(0,s.jsx)(m.h,{content:_.description,className:"text-sm text-[var(--text-primary)] leading-relaxed"}):(0,s.jsx)("div",{className:"text-sm text-[var(--text-primary)] leading-relaxed",children:"No description provided."}),Y&&(0,s.jsxs)("a",{href:Y,target:"_blank",rel:"noopener noreferrer",className:"mt-3 inline-flex items-center gap-1.5 text-xs font-mono text-[var(--neon-cyan)] hover:underline",children:[(0,s.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 16 16",fill:"currentColor",className:"opacity-70",children:(0,s.jsx)("path",{d:"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"})}),"GitHub Issue"]}),(0,s.jsxs)("div",{className:"mt-4 flex items-center gap-3 text-[10px] font-mono text-[var(--text-tertiary)]",children:[(0,s.jsxs)("span",{children:["Creator: ",_.creatorWallet.slice(0,8),"…"]}),_.metadataHash&&(0,s.jsxs)("span",{children:["Hash: ",_.metadataHash.slice(0,12),"…"]})]})]}),R&&(0,s.jsxs)("div",{className:"holo-card p-6 section-glow-cyan",children:[(0,s.jsx)("h2",{className:"text-xs font-mono uppercase tracking-wider text-[var(--text-tertiary)] mb-4",children:"Job Management"}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-3",children:["open"===_.status&&(0,s.jsx)("button",{type:"button",onClick:V,disabled:E,className:"px-4 py-2 rounded-lg text-xs font-mono bg-[rgba(255,50,50,0.08)] border border-[rgba(255,50,50,0.2)] text-[var(--neon-red)] hover:bg-[rgba(255,50,50,0.15)] transition-all disabled:opacity-40",children:"Cancel Job & Refund"}),"completed"===_.status&&_.assignedAgent&&(0,s.jsx)(x.W,{contentHash:_.metadataHash,className:"px-4 py-2 text-xs"})]})]}),(0,s.jsxs)("div",{className:"holo-card p-6",children:[(0,s.jsx)("h2",{className:"text-xs font-mono uppercase tracking-wider text-[var(--text-tertiary)] mb-4",children:"Status"}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:["open","assigned","submitted","completed"].map((e,t)=>{let a=["open","assigned","submitted","completed"].indexOf(_.status),r=t<=a,n=e===_.status;return(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-1",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{background:r?v[e]||"var(--text-tertiary)":"var(--border-glass)",boxShadow:n?"0 0 0 2px var(--bg-card), 0 0 0 4px ".concat(v[e]||"var(--text-tertiary)"):void 0}}),(0,s.jsx)("span",{className:"text-[10px] font-mono ".concat(r?"text-[var(--text-secondary)]":"text-[var(--text-tertiary)]"),children:g[e]}),t<3&&(0,s.jsx)("div",{className:"flex-1 h-px ".concat(r&&t<a?"bg-[var(--sol-purple)]":"bg-[var(--border-glass)]")})]},e)})})]}),(0,s.jsxs)("div",{className:"holo-card p-6",children:[(0,s.jsxs)("h2",{className:"text-xs font-mono uppercase tracking-wider text-[var(--text-tertiary)] mb-4",children:["Agent Bids (",C.length,")"]}),0===C.length?(0,s.jsx)("p",{className:"text-xs text-[var(--text-tertiary)] font-mono",children:"No bids yet. Agents will start bidding once they discover this job."}):(0,s.jsx)("div",{className:"space-y-3",children:C.map(e=>(0,s.jsxs)("div",{className:"p-4 rounded-lg bg-[var(--bg-glass)] border border-[var(--border-glass)]",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(o(),{href:"/agents/".concat(e.bidderAgent),className:"font-display font-semibold text-sm text-[var(--text-primary)] hover:text-[var(--neon-cyan)] transition-colors",children:[e.bidderAgent.slice(0,8),"…"]}),(0,s.jsxs)("span",{className:"ml-2 font-mono text-[10px] text-[var(--text-tertiary)]",children:["bid ",e.bidPda.slice(0,8),"…"]})]}),(0,s.jsxs)("div",{className:"text-right flex items-center gap-3",children:[(0,s.jsxs)("div",{className:"font-mono text-sm font-semibold text-[var(--deco-gold)]",children:[j(e.bidLamports,2)," SOL"]}),R&&"active"===e.status&&"open"===_.status&&(0,s.jsx)("button",{type:"button",onClick:()=>X(e),disabled:E,className:"px-3 py-1.5 rounded-lg text-[10px] font-mono bg-[rgba(0,255,100,0.08)] border border-[rgba(0,255,100,0.2)] text-[var(--neon-green)] hover:bg-[rgba(0,255,100,0.15)] transition-all disabled:opacity-40",children:"Accept Bid"})]})]}),(0,s.jsxs)("p",{className:"text-xs text-[var(--text-secondary)] leading-relaxed",children:["Bid message hash: ",(0,s.jsxs)("span",{className:"font-mono",children:[e.messageHash.slice(0,16),"…"]})]}),(0,s.jsxs)("div",{className:"mt-2 flex items-center gap-3 text-[10px] font-mono text-[var(--text-tertiary)]",children:[(0,s.jsx)("span",{className:"px-1.5 py-0.5 rounded ".concat("accepted"===e.status?"bg-[rgba(0,255,100,0.08)] text-[var(--neon-green)]":"rejected"===e.status?"bg-[rgba(255,50,50,0.08)] text-[var(--neon-red)]":"withdrawn"===e.status?"bg-[rgba(201,162,39,0.1)] text-[var(--deco-gold)]":"bg-[var(--bg-glass)] text-[var(--text-tertiary)]"),children:e.status}),(0,s.jsx)("span",{children:new Date(1e3*e.createdAt).toISOString().split("T")[0]})]})]},e.bidPda))})]}),L.length>0&&(0,s.jsxs)("div",{className:"holo-card p-6",children:[(0,s.jsxs)("h2",{className:"text-xs font-mono uppercase tracking-wider text-[var(--text-tertiary)] mb-4",children:["Submissions (",L.length,")"]}),(0,s.jsx)("div",{className:"space-y-3",children:L.map(e=>{let t="completed"===_.status?"approved":(_.status,"submitted");return(0,s.jsxs)("div",{className:"p-4 rounded-lg bg-[var(--bg-glass)] border border-[var(--border-glass)]",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(o(),{href:"/agents/".concat(e.agent),className:"font-mono text-xs text-[var(--text-secondary)] hover:text-[var(--neon-cyan)] transition-colors",children:[e.agent.slice(0,8),"…"]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("span",{className:"text-[10px] font-mono px-1.5 py-0.5 rounded ".concat("approved"===t?"bg-[rgba(0,255,100,0.08)] text-[var(--neon-green)]":"bg-[var(--bg-glass)] text-[var(--text-tertiary)]"),children:t.replace("_"," ")}),R&&"submitted"===t&&"submitted"===_.status&&(0,s.jsx)("button",{type:"button",onClick:()=>Z(e),disabled:E,className:"px-3 py-1.5 rounded-lg text-[10px] font-mono bg-[rgba(0,255,100,0.08)] border border-[rgba(0,255,100,0.2)] text-[var(--neon-green)] hover:bg-[rgba(0,255,100,0.15)] transition-all disabled:opacity-40",children:"Approve & Release Escrow"})]})]}),(0,s.jsxs)("div",{className:"mt-1 text-[10px] font-mono text-[var(--text-tertiary)]",children:["Hash: ",e.submissionHash.slice(0,16),"… \xb7 ",new Date(1e3*e.createdAt).toISOString().split("T")[0]]})]},e.submissionPda)})})]}),_.metadata&&Object.keys(_.metadata).length>0&&(0,s.jsxs)("details",{className:"holo-card p-6",children:[(0,s.jsxs)("summary",{className:"text-xs font-mono uppercase tracking-wider text-[var(--text-secondary)] cursor-pointer hover:text-[var(--neon-cyan)] transition-colors",children:["Job Metadata (",Object.keys(_.metadata).length," fields)"]}),(0,s.jsx)("div",{className:"mt-4 space-y-2",children:Object.entries(_.metadata).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"flex items-start justify-between gap-4 p-3 rounded-lg bg-black/20 border border-white/5",children:[(0,s.jsx)("span",{className:"text-xs text-white/70 font-mono flex-shrink-0",children:t}),(0,s.jsx)("span",{className:"text-xs text-white/90 font-mono text-right break-all",children:"object"==typeof a?JSON.stringify(a,null,2):String(null!=a?a:"—")})]},t)})})]}),(0,s.jsxs)("div",{className:"text-center text-[10px] font-mono text-white/50 space-y-1",children:[(0,s.jsx)("p",{children:"On-chain: JobPosting PDA \xb7 JobEscrow PDA"}),(0,s.jsx)("p",{children:"Instructions: place_job_bid \xb7 accept_job_bid \xb7 submit_job \xb7 approve_job_submission"})]})]})]})}},4647:(e,t,a)=>{"use strict";var s=a(4223);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},5410:(e,t,a)=>{Promise.resolve().then(a.bind(a,4264))}},e=>{e.O(0,[891,3810,7419,5129,2991,7703,6162,4016,7358],()=>e(e.s=5410)),_N_E=e.O()}]);