$schema: "https://json-schema.org/draft/2020-12/schema"
title: CodexBlocksIndex
description: "Compiled index of all block-level tags across the codex repository"
type: object
required: [generatedAt, version, stats, strands]
properties:
  generatedAt:
    type: string
    format: date-time
    description: "ISO 8601 timestamp when this index was generated"
  version:
    type: string
    pattern: "^\\d+\\.\\d+\\.\\d+$"
    description: "Schema version for this index format"
  stats:
    type: object
    description: "Aggregate statistics for the block index"
    required: [totalStrands, totalBlocks, totalTags, worthyBlocks]
    properties:
      totalStrands:
        type: integer
        minimum: 0
        description: "Number of strands with block-level data"
      totalBlocks:
        type: integer
        minimum: 0
        description: "Total number of blocks across all strands"
      totalTags:
        type: integer
        minimum: 0
        description: "Total number of block-level tags"
      uniqueTags:
        type: integer
        minimum: 0
        description: "Number of unique tags"
      worthyBlocks:
        type: integer
        minimum: 0
        description: "Blocks with worthiness score >= 0.5"
      pendingSuggestions:
        type: integer
        minimum: 0
        description: "Number of blocks with pending tag suggestions"
      tagsBySource:
        type: object
        description: "Tag counts by source"
        properties:
          inline: { type: integer, minimum: 0, description: "Explicit #hashtags in content" }
          nlp: { type: integer, minimum: 0, description: "Vocabulary/TF-IDF extraction" }
          llm: { type: integer, minimum: 0, description: "AI-suggested with reasoning" }
          existing: { type: integer, minimum: 0, description: "Propagated from document" }
          user: { type: integer, minimum: 0, description: "Manually confirmed" }
      blocksByType:
        type: object
        description: "Block counts by type"
        additionalProperties: { type: integer, minimum: 0 }
  tagIndex:
    type: object
    description: "Inverted index: tag -> list of block references"
    additionalProperties:
      type: array
      items:
        type: object
        required: [strandPath, blockId]
        properties:
          strandPath: { type: string }
          blockId: { type: string }
          confidence: { type: number, minimum: 0, maximum: 1 }
  strands:
    type: object
    description: "Per-strand block data, keyed by strand path"
    additionalProperties:
      type: object
      required: [path, blockCount, blocks]
      properties:
        path:
          type: string
          description: "Relative path to the strand file"
        title:
          type: string
          description: "Strand title for display"
        blockCount:
          type: integer
          minimum: 0
        tagCount:
          type: integer
          minimum: 0
        worthyBlockCount:
          type: integer
          minimum: 0
        blocks:
          type: array
          description: "All blocks in this strand"
          items:
            type: object
            required: [id, line, type]
            properties:
              id: { type: string }
              line: { type: integer }
              endLine: { type: integer }
              type: { type: string }
              headingLevel: { type: integer }
              headingText: { type: string }
              tags:
                type: array
                items: { type: string }
              suggestedTags:
                type: array
                items:
                  type: object
                  properties:
                    tag: { type: string }
                    confidence: { type: number }
                    source: { type: string }
              worthiness:
                type: object
                properties:
                  score: { type: number }
                  signals:
                    type: object
                    additionalProperties: { type: number }
              extractiveSummary: { type: string }
              warrantsIllustration: { type: boolean }

