// File: frontend/src/styles/components/_chat-window.scss
/**
 * @file _chat-window.scss
 * @version 3.0.0
 * @description Enhanced styles for ChatWindow.vue with living text effects,
 * organic message flow, and state-based animations. Implements "Her"-inspired
 * warm, intimate conversation aesthetics with dynamic text rendering.
 */

@use '../abstracts/variables' as var;
@use '../abstracts/mixins' as mixins;

// -----------------------------------------------------------------------------
// Chat Window Container
// -----------------------------------------------------------------------------
.chat-window-container-ephemeral {
  display: flex;
  flex-direction: column;
  height: 100%;
  width: 100%;
  overflow: hidden;
  position: relative;
  
  // Subtle ambient glow that responds to conversation
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 50%;
    width: 300%;
    height: 100%;
    transform: translateX(-50%);
    background: radial-gradient(
      ellipse at center top,
      hsla(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l), 0.05) 0%,
      transparent 50%
    );
    pointer-events: none;
    opacity: var(--chat-ambient-opacity, 0);
    transition: opacity var.$duration-movement var.$ease-out-sine;
  }
  
  // Active conversation state
  &.conversation-active {
    --chat-ambient-opacity: 1;
    
    &::before {
      animation: ambientPulse 6s var.$ease-in-out-sine infinite;
    }
  }
}

// -----------------------------------------------------------------------------
// Messages Wrapper with Custom Scrollbar
// -----------------------------------------------------------------------------
.chat-messages-wrapper-ephemeral {
  flex-grow: 1;
  overflow-y: auto;
  overflow-x: hidden;
  padding: var.$spacing-lg;
  position: relative;
  scroll-behavior: smooth;
  
  // Enhanced custom scrollbar for chat
  @include mixins.custom-scrollbar(
    '--color-accent-primary',
    0.3,
    0.6,
    '--color-bg-secondary',
    0.1,
    6px
  );
  
  // Fade out at top for better visual hierarchy
  &::before {
    content: '';
    position: sticky;
    top: 0;
    left: 0;
    right: 0;
    height: 40px;
    background: linear-gradient(
      to bottom,
      hsl(var(--color-bg-primary-h), var(--color-bg-primary-s), var(--color-bg-primary-l)) 0%,
      hsla(var(--color-bg-primary-h), var(--color-bg-primary-s), var(--color-bg-primary-l), 0) 100%
    );
    pointer-events: none;
    z-index: 10;
  }
  
  @media (min-width: var.$breakpoint-md) {
    padding: var.$spacing-xl var.$spacing-2xl;
  }
}

// -----------------------------------------------------------------------------
// Welcome Placeholder with Organic Animation
// -----------------------------------------------------------------------------
.welcome-placeholder-ephemeral {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 400px;
  text-align: center;
  padding: var.$spacing-2xl;
  animation: welcomeFadeIn 1s var.$ease-out-quint forwards;
  
  @keyframes welcomeFadeIn {
    from {
      opacity: 0;
      transform: translateY(20px) scale(0.95);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
  
  .welcome-logo-ephemeral {
    width: 80px;
    height: 80px;
    margin-bottom: var.$spacing-lg;
    color: hsl(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l));
    opacity: 0;
    animation: 
      logoAppear 0.8s var.$ease-out-cubic 0.3s forwards,
      logoFloat 6s var.$ease-in-out-sine 1.1s infinite;
    
    @keyframes logoAppear {
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
    
    @keyframes logoFloat {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-10px);
      }
    }
  }
  
  .welcome-title-ephemeral {
    font-size: var.$font-size-xl;
    font-weight: 600;
    color: hsl(var(--color-text-primary-h), var(--color-text-primary-s), var(--color-text-primary-l));
    margin-bottom: var.$spacing-sm;
    opacity: 0;
    animation: textReveal 0.8s var.$ease-out-cubic 0.5s forwards;
    
    @keyframes textReveal {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  }
  
  .welcome-subtitle-ephemeral {
    font-size: var.$font-size-base-default;
    color: hsl(var(--color-text-secondary-h), var(--color-text-secondary-s), var(--color-text-secondary-l));
    max-width: 500px;
    line-height: 1.6;
    opacity: 0;
    animation: textReveal 0.8s var.$ease-out-cubic 0.7s forwards;
  }
  
  .example-prompts-grid-ephemeral {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var.$spacing-sm;
    margin-top: var.$spacing-xl;
    width: 100%;
    max-width: 600px;
    opacity: 0;
    animation: promptsAppear 0.8s var.$ease-out-cubic 1s forwards;
    
    @keyframes promptsAppear {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  }
  
  .prompt-tag-ephemeral {
    padding: var.$spacing-sm var.$spacing-md;
    background-color: hsla(
      var(--color-bg-secondary-h),
      var(--color-bg-secondary-s),
      var(--color-bg-secondary-l),
      0.8
    );
    border: 1px solid hsla(
      var(--color-border-secondary-h),
      var(--color-border-secondary-s),
      var(--color-border-secondary-l),
      0.5
    );
    border-radius: var(--radius-lg, var.$radius-lg);
    color: hsl(var(--color-text-secondary-h), var(--color-text-secondary-s), var(--color-text-secondary-l));
    font-size: var.$font-size-sm;
    transition: all var.$duration-quick var.$ease-out-cubic;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    
    // Shimmer effect on hover
    &::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        90deg,
        transparent,
        hsla(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l), 0.2),
        transparent
      );
      transition: left 0.5s var.$ease-out-cubic;
    }
    
    &:hover {
      background-color: hsla(
        var(--color-bg-secondary-h),
        var(--color-bg-secondary-s),
        calc(var(--color-bg-secondary-l) * 1.1),
        0.9
      );
      border-color: hsl(var(--color-accent-interactive-h), var(--color-accent-interactive-s), var(--color-accent-interactive-l));
      color: hsl(var(--color-text-primary-h), var(--color-text-primary-s), var(--color-text-primary-l));
      transform: translateY(-2px);
      box-shadow: 
        0 4px 12px hsla(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l), 0.2),
        0 2px 4px hsla(var(--shadow-color-h), var(--shadow-color-s), var(--shadow-color-l), 0.1);
      
      &::before {
        left: 100%;
      }
    }
    
    &:active {
      transform: translateY(0);
    }
  }
}

// -----------------------------------------------------------------------------
// Loading Indicator with Living Animation
// -----------------------------------------------------------------------------
.loading-indicator-chat-ephemeral {
  display: flex;
  align-items: center;
  gap: var.$spacing-md;
  padding: var.$spacing-lg;
  margin: var.$spacing-md 0;
  animation: loadingAppear 0.5s var.$ease-out-cubic forwards;
  
  @keyframes loadingAppear {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .spinner-dots-ephemeral {
    display: flex;
    gap: var.$spacing-xs;
    
    .dot-ephemeral {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: hsl(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l));
      animation: dotPulse 1.4s var.$ease-in-out-sine infinite;
      
      &.dot-1 { animation-delay: 0s; }
      &.dot-2 { animation-delay: 0.2s; }
      &.dot-3 { animation-delay: 0.4s; }
      
      @keyframes dotPulse {
        0%, 60%, 100% {
          transform: scale(1);
          opacity: 0.6;
        }
        30% {
          transform: scale(1.5);
          opacity: 1;
        }
      }
    }
  }
  
  .loading-text-ephemeral {
    font-size: var.$font-size-sm;
    color: hsl(var(--color-text-secondary-h), var(--color-text-secondary-s), var(--color-text-secondary-l));
    font-style: italic;
    opacity: 0.8;
    animation: textBreatheSlow 3s var.$ease-in-out-sine infinite;
    
    @keyframes textBreatheSlow {
      0%, 100% {
        opacity: 0.8;
      }
      50% {
        opacity: 1;
      }
    }
  }
}

// -----------------------------------------------------------------------------
// Message Stream Animation Effects
// -----------------------------------------------------------------------------
.message-stream-container {
  position: relative;
  
  // Streaming indicator line
  &.is-streaming {
    &::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background: linear-gradient(
        to bottom,
        transparent,
        hsl(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l)),
        transparent
      );
      animation: streamingLine 2s linear infinite;
    }
  }
  
  @keyframes streamingLine {
    0% {
      transform: translateY(-100%);
    }
    100% {
      transform: translateY(100%);
    }
  }
}

// -----------------------------------------------------------------------------
// Text Animation Classes for Different Content Types
// -----------------------------------------------------------------------------
.text-animate-container {
  position: relative;
  
  // Character-by-character animation
  &.animate-char {
    .text-char {
      display: inline-block;
      opacity: 0;
      animation: charBloom var(--char-duration, 0.05s) var(--char-delay, 0s) var.$ease-out-cubic forwards;
      
      // Every 5th character gets a subtle glow
      &:nth-child(5n) {
        animation-name: charBloomGlow;
      }
    }
  }
  
  // Word-by-word animation
  &.animate-word {
    .text-word {
      display: inline-block;
      opacity: 0;
      animation: wordMaterialize var(--word-duration, 0.15s) var(--word-delay, 0s) var.$ease-out-quint forwards;
      margin-right: 0.25em; // Natural word spacing
    }
  }
  
  // Line-by-line animation (for code)
  &.animate-line {
    .text-line {
      display: block;
      opacity: 0;
      animation: lineCascade var(--line-duration, 0.3s) var(--line-delay, 0s) var.$ease-out-cubic forwards;
      position: relative;
      padding-left: 1em;
    }
  }
}

// Character bloom with glow variant
@keyframes charBloomGlow {
  0% {
    opacity: 0;
    transform: scale(0) rotate(180deg);
    filter: blur(10px) hue-rotate(180deg);
    text-shadow: 0 0 20px hsla(var(--color-accent-glow-h), var(--color-accent-glow-s), var(--color-accent-glow-l), 0);
  }
  40% {
    opacity: 0.5;
    transform: scale(1.4) rotate(90deg);
    filter: blur(4px) hue-rotate(90deg);
    text-shadow: 0 0 15px hsla(var(--color-accent-glow-h), var(--color-accent-glow-s), var(--color-accent-glow-l), 0.8);
  }
  70% {
    opacity: 0.8;
    transform: scale(1.1) rotate(20deg);
    filter: blur(1px) hue-rotate(20deg);
    text-shadow: 0 0 8px hsla(var(--color-accent-glow-h), var(--color-accent-glow-s), var(--color-accent-glow-l), 0.5);
  }
  100% {
    opacity: 1;
    transform: scale(1) rotate(0deg);
    filter: blur(0) hue-rotate(0deg);
    text-shadow: 0 0 3px hsla(var(--color-accent-glow-h), var(--color-accent-glow-s), var(--color-accent-glow-l), 0.3);
  }
}

// -----------------------------------------------------------------------------
// Living Text Effects (Post-animation)
// -----------------------------------------------------------------------------
.message-content {
  // Recent messages have subtle breathing effect
  &.message-recent {
    .text-animated {
      animation: textBreatheSoft 4s var.$ease-in-out-sine infinite;
      
      @keyframes textBreatheSoft {
        0%, 100% {
          opacity: 1;
          transform: translateY(0);
        }
        50% {
          opacity: 0.98;
          transform: translateY(-0.5px);
        }
      }
    }
  }
  
  // Active streaming text has shimmer
  &.message-streaming {
    .text-animated {
      background: linear-gradient(
        90deg,
        hsl(var(--color-text-primary-h), var(--color-text-primary-s), var(--color-text-primary-l)),
        hsl(var(--color-text-accent-h), var(--color-text-accent-s), var(--color-text-accent-l)),
        hsl(var(--color-text-primary-h), var(--color-text-primary-s), var(--color-text-primary-l))
      );
      background-size: 200% 100%;
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: textShimmer 3s linear infinite;
    }
  }
  
  // Hover effect for interactive text
  .text-interactive:hover {
    animation: textPulseGlow 1s var.$ease-in-out-sine;
    cursor: pointer;
  }
}

// -----------------------------------------------------------------------------
// Conversation Flow Indicators
// -----------------------------------------------------------------------------
.conversation-flow {
  position: relative;
  
  // Connection lines between related messages
  &.show-connections {
    .message-connection-line {
      position: absolute;
      left: 20px;
      top: -20px;
      bottom: 20px;
      width: 2px;
      background: linear-gradient(
        to bottom,
        hsla(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l), 0),
        hsla(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l), 0.3),
        hsla(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l), 0)
      );
      opacity: 0;
      animation: connectionFade 0.5s var.$ease-out-cubic forwards;
      
      @keyframes connectionFade {
        to {
          opacity: 1;
        }
      }
    }
  }
}

// -----------------------------------------------------------------------------
// Terminal Theme Specific Styles
// -----------------------------------------------------------------------------
.theme-terminus-dark,
.theme-terminus-light {
  .chat-window-container-ephemeral {
    font-family: var(--font-family-mono);
    
    // CRT scanline effect
    &::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(
        to bottom,
        transparent,
        hsla(var(--color-phosphor-h), var(--color-phosphor-s), var(--color-phosphor-l), 0.8),
        transparent
      );
      animation: crtScanline 8s linear infinite;
      pointer-events: none;
      opacity: var(--crt-scanline-opacity, 0.03);
    }
  }
  
  .welcome-logo-ephemeral {
    filter: drop-shadow(0 0 4px hsl(var(--color-phosphor-h), var(--color-phosphor-s), var(--color-phosphor-l)));
  }
  
  .text-animate-container {
    // Terminal typing effect
    &.animate-terminal {
      .text-char {
        opacity: 0;
        animation: terminalType 0s var(--char-delay, 0s) steps(1) forwards;
        
        @keyframes terminalType {
          to {
            opacity: 1;
          }
        }
      }
      
      // Cursor at end
      &::after {
        content: '█';
        color: hsl(var(--color-phosphor-h), var(--color-phosphor-s), var(--color-phosphor-l));
        animation: terminalCursorBlink 1s steps(1) infinite;
      }
    }
  }
  
  // ASCII art decorations
  .loading-indicator-chat-ephemeral {
    .spinner-dots-ephemeral {
      font-family: monospace;
      
      .dot-ephemeral {
        width: auto;
        height: auto;
        background: none;
        color: hsl(var(--color-phosphor-h), var(--color-phosphor-s), var(--color-phosphor-l));
        
        &::before {
          content: var(--ascii-particle-1, '░');
          animation: asciiRotate 1.4s steps(4) infinite;
        }
        
        @keyframes asciiRotate {
          0% { content: var(--ascii-particle-1, '░'); }
          25% { content: var(--ascii-particle-2, '▒'); }
          50% { content: var(--ascii-particle-3, '▓'); }
          75% { content: var(--ascii-particle-4, '█'); }
          100% { content: var(--ascii-particle-1, '░'); }
        }
      }
    }
  }
}

// Reduced motion preferences
@media (prefers-reduced-motion: reduce) {
  .text-animate-container {
    .text-char,
    .text-word,
    .text-line {
      animation-duration: 0.01ms !important;
      animation-delay: 0ms !important;
    }
  }
  
  .message-content {
    &.message-recent .text-animated,
    &.message-streaming .text-animated {
      animation: none !important;
    }
  }
}