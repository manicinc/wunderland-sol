// File: frontend/src/styles/components/_dropdowns.scss
/**
 * @file _dropdowns.scss
 * @version 2.2.0
 * @description Shared styles for dropdown menu components for "Ephemeral Harmony".
 * Defines visual appearance, structure, and interactive states.
 * Adds considerations for default positioning to mitigate cutoff issues, though
 * complex dynamic positioning relies on JS in the Vue components.
 *
 * @role Provides consistent styling for all dropdown components.
 * @dependencies `../abstracts/variables`, `../abstracts/mixins`, `./buttons`.
 */

@use '../abstracts/variables' as var;
@use '../abstracts/mixins' as mixins;
@use './buttons' as buttonsFile;

/**
 * @mixin dropdown-panel-ephemeral
 * @description Styles for the main dropdown panel container.
 * Now includes basic absolute positioning from the top-right of its relative parent.
 */
@mixin dropdown-panel-ephemeral {
  // Core Visuals (from your provided file, these are good)
  @include mixins.neomorphic-extrude(
    $distance: 4px, // Slightly reduced distance for a tighter feel
    $blur: 12px,    // Softer blur
    $shadow-opacity-var: '--shadow-opacity-medium',
    $radius: var.$radius-lg, // Slightly smaller radius for panels
    $fb-bg-l: calc(#{var.$default-color-bg-secondary-l} - 2%),
    $fb-bg-a: 0.98 // More opaque for readability over content
    // Other fallbacks as previously defined
  );

  @include mixins.holographic-border-glow(
    $accent-color-var-prefix: '--color-accent-interactive',
    $secondary-accent-var-prefix: '--color-accent-secondary',
    $border-width: 1.5px, // Slightly thicker glow border
    $animation-duration: 4s,
    $radius: var.$radius-lg // Matches panel radius
  );

  border: 1px solid hsla(var(--color-border-primary-h, var.$default-color-border-primary-h), var(--color-border-primary-s, var.$default-color-border-primary-s), var(--color-border-primary-l, var.$default-color-border-primary-l), 0.25); // Clearer border
  padding: var.$spacing-xs; // Reduced base padding, content will add more
  min-width: 250px; // Slightly wider min-width
  max-width: 320px; // Max width to prevent overly wide dropdowns
  z-index: var.$z-index-dropdown;
  box-shadow: var(--shadow-depth-xl, #{var.$scss-box-shadow-xl});
  overflow: hidden; // Important for border-radius on children

  // --- Default Positioning Strategy (can be overridden by JS positioning libraries) ---
  position: absolute;
  // Position it below the header trigger by default.
  // Assumes the parent trigger container (.header-control-item) is position: relative.
  top: 100%; // Start right below the relative parent (trigger wrapper)
  right: 0;  // Align to the right of the trigger wrapper
  margin-top: var.$spacing-sm; // Add a small gap between trigger and panel

  // Transform origin for animations (Tailwind `origin-top-right` equivalent)
  transform-origin: top right;
}

/**
 * @mixin dropdown-header-ephemeral
 * @description Styles for the header section within a dropdown panel.
 */
@mixin dropdown-header-ephemeral {
  padding: var.$spacing-sm var.$spacing-md;
  border-bottom: 1px solid hsla(var(--color-border-primary-h, var.$default-color-border-primary-h), var(--color-border-primary-s, var.$default-color-border-primary-s), var(--color-border-primary-l, var.$default-color-border-primary-l), 0.2); // Slightly more visible border
  // Margin adjusted to work with new panel padding
  margin: calc(var.$spacing-xs * -1) calc(var.$spacing-xs * -1) var.$spacing-sm;
  background-color: hsla(var(--color-bg-tertiary-h, var.$default-color-bg-tertiary-h), var(--color-bg-tertiary-s, var.$default-color-bg-tertiary-s), var(--color-bg-tertiary-l, var.$default-color-bg-tertiary-l), 0.1); // More subtle header bg
  border-top-left-radius: inherit; // Inherit from panel's radius
  border-top-right-radius: inherit;

  .dropdown-title {
    font-size: calc(var.$font-size-xs * 0.95); // Slightly larger
    font-weight: 600;
    color: hsl(var(--color-text-muted-h, var.$default-color-text-muted-h), var(--color-text-muted-s, var.$default-color-text-muted-l), calc(var(--color-text-muted-l, #{var.$default-color-text-muted-l}) + 5%)); // Brighter muted text
    text-transform: uppercase;
    letter-spacing: 0.08em; // Slightly wider spacing
    opacity: 0.9;
    @include mixins.text-glow( // Softer glow
      $glow-color-var-prefix: '--color-text-muted',
      $glow-radius: 5px,
      $fb-glow-h: var.$default-color-text-muted-h,
      $fb-glow-s: var.$default-color-text-muted-s,
      $fb-glow-l: var.$default-color-text-muted-l,
      $fb-glow-a: 0.15
    );
  }
}

/**
 * @mixin dropdown-content-ephemeral
 * @description Styles for the main scrollable content area of a dropdown.
 */
@mixin dropdown-content-ephemeral {
  padding: var.$spacing-xs; // Base padding for the content area itself
  // max-height: min(70vh, 450px); // Increased max-height, more viewport aware
  max-height: clamp(200px, 60vh, 450px); // Ensure a minimum reasonable height
  overflow-y: auto;
  @include mixins.custom-scrollbar(
    $thumb-color-var-prefix: '--color-accent-interactive',
    $thumb-base-alpha: 0.6, // More visible thumb
    $thumb-hover-alpha: 0.8,
    $track-color-var-prefix: '--color-bg-secondary',
    $track-alpha: 0.25, // Slightly more visible track
    $width: 7px,
    $border-radius: var.$radius-sm
  );
}

/**
 * @mixin dropdown-item-ephemeral
 * @description Styles for individual items within a dropdown menu.
 */
@mixin dropdown-item-ephemeral {
  @include buttonsFile.base-button-styles; // Ensure this provides necessary flex, align-items etc.
  width: 100%;
  justify-content: flex-start !important;
  padding: calc(var.$spacing-sm + 2px) var.$spacing-md !important; // Consistent, comfortable padding
  border-radius: var.$radius-md !important; // Consistent radius with other interactive elements
  font-size: var.$font-size-base-default !important; // Readable base font size
  font-weight: 500 !important;
  color: hsl(var(--color-text-secondary-h, var.$default-color-text-secondary-h), var(--color-text-secondary-s, var.$default-color-text-secondary-s), calc(var(--color-text-secondary-l, #{var.$default-color-text-secondary-l}) + 5%)); // Slightly brighter secondary text
  text-align: left;
  background-color: transparent;
  border: 1px solid transparent;
  transition: background-color var.$duration-quick var.$ease-out-quad,
              color var.$duration-quick var.$ease-out-quad,
              transform var.$duration-quick var.$ease-elastic,
              box-shadow var.$duration-smooth var.$ease-out-quad;

  .dropdown-item-icon {
    width: 1.25rem; // Slightly larger icon
    height: 1.25rem;
    margin-right: var.$spacing-md; // Good separation
    color: hsl(var(--color-text-muted-h, var.$default-color-text-muted-h), var(--color-text-muted-s, var.$default-color-text-muted-l), calc(var(--color-text-muted-l, #{var.$default-color-text-muted-l}) + 10%)); // Brighter muted icon
    transition: color var.$duration-quick, transform var.$duration-quick var.$ease-elastic;
    flex-shrink: 0;
    opacity: 0.9;
  }

  &:hover,
  &.router-link-active, // For Vue Router active links
  &.active { // Generic active class
    background-color: hsla(var(--color-accent-interactive-h, var.$default-color-accent-interactive-h), var(--color-accent-interactive-s, var.$default-color-accent-interactive-s), var(--color-accent-interactive-l, var.$default-color-accent-interactive-l), 0.25) !important; // More prominent hover
    color: hsl(var(--color-accent-interactive-h, var.$default-color-accent-interactive-h), var(--color-accent-interactive-s, var.$default-color-accent-interactive-s), var(--color-accent-interactive-l, var.$default-color-accent-interactive-l)) !important;
    transform: translateX(5px) scale(1.02); // More noticeable interactive feedback
    box-shadow: 0 0 15px 3px hsla(var(--color-accent-interactive-h, var.$default-color-accent-interactive-h), var(--color-accent-interactive-s, var.$default-color-accent-interactive-s), var(--color-accent-interactive-l, var.$default-color-accent-interactive-l), 0.3); // Enhanced glow/shadow

    .dropdown-item-icon {
      color: hsl(var(--color-accent-interactive-h, var.$default-color-accent-interactive-h), var(--color-accent-interactive-s, var.$default-color-accent-interactive-s), var(--color-accent-interactive-l, var.$default-color-accent-interactive-l));
      transform: scale(1.15) rotate(-5deg); // More dynamic icon
      opacity: 1;
    }
  }

  &:active { // When pressed
    transform: translateX(3px) scale(0.97) !important; // Clear press effect
    background-color: hsla(var(--color-accent-interactive-h, var.$default-color-accent-interactive-h), var(--color-accent-interactive-s, var.$default-color-accent-interactive-s), var(--color-accent-interactive-l, var.$default-color-accent-interactive-l), 0.32) !important;
    box-shadow: inset 0 2px 4px hsla(var(--color-accent-interactive-h, var.$default-color-accent-interactive-h), var(--color-accent-interactive-s, var.$default-color-accent-interactive-s), calc(var(--color-accent-interactive-l, #{var.$default-color-accent-interactive-l}) - 12%), 0.35); // More distinct inset shadow
    filter: brightness(0.9);
  }

  &:focus-visible { // Ensure clear focus state
    outline: none;
    border-color: hsla(var(--color-accent-interactive-h, var.$default-color-accent-interactive-h), var(--color-accent-interactive-s, var.$default-color-accent-interactive-s), var(--color-accent-interactive-l, var.$default-color-accent-interactive-l), 0.7);
    background-color: hsla(var(--color-accent-interactive-h, var.$default-color-accent-interactive-h), var(--color-accent-interactive-s, var.$default-color-accent-interactive-s), var(--color-accent-interactive-l, var.$default-color-accent-interactive-l), 0.15);
    @include mixins.focus-ring(
      $base-bg-color-var-prefix: '--color-bg-secondary',
      $ring-accent-color-var-prefix: '--color-accent-interactive',
      $offset-width: 1px, // Tighter offset for items
      $ring-thickness: 2px,
      $ring-opacity: 0.85
    );
  }

  &[disabled],
  &:disabled { /* Styles for disabled state are good */ }
}

/**
 * @mixin dropdown-section-title-ephemeral
 * @description Styles for titles that demarcate sections within a dropdown menu.
 */
@mixin dropdown-section-title-ephemeral {
  // Styles seem fine, ensure visual hierarchy against items
  padding: var.$spacing-xs var.$spacing-sm;
  margin-top: var.$spacing-md; // More space above section titles
  margin-bottom: var.$spacing-xs;
  font-size: calc(var.$font-size-xs * 0.88); // Slightly smaller, more refined
  letter-spacing: 0.07em;
}

/**
 * @mixin dropdown-divider-ephemeral
 * @description Styles for a visual divider line within a dropdown menu.
 */
@mixin dropdown-divider-ephemeral {
  // Styles seem fine
  margin: var.$spacing-sm calc(var.$spacing-xs / 2); // Slightly less horizontal margin for divider
}

// --- Utility Classes (Applied in SCSS files that use these dropdowns) ---
.dropdown-panel-ephemeral { @include dropdown-panel-ephemeral; }
.dropdown-header-ephemeral { @include dropdown-header-ephemeral; }
.dropdown-content-ephemeral { @include dropdown-content-ephemeral; }
.dropdown-item-ephemeral { @include dropdown-item-ephemeral; }
.dropdown-divider-ephemeral { @include dropdown-divider-ephemeral; }
.dropdown-section-title-ephemeral { @include dropdown-section-title-ephemeral; }

// --- Dropdown Transition Animations ---
// These are applied to the <Transition name="..."> component in Vue.
// The transform-origin on the .dropdown-panel-ephemeral itself is important.
.dropdown-float-enhanced-enter-active,
.dropdown-float-enhanced-leave-active {
  transition: opacity 0.25s var.$ease-out-quint, transform 0.3s var.$ease-elastic; // Slightly faster, more elastic
}
.dropdown-float-enhanced-enter-from,
.dropdown-float-enhanced-leave-to {
  opacity: 0;
  transform: translateY(10px) scale(0.94); // Adjusted transform for a smoother appearance
}

// This neomorphic transition might be more suitable for panels appearing from a neomorphic button
.dropdown-float-neomorphic-enter-active,
.dropdown-float-neomorphic-leave-active {
  transition: opacity 0.2s var.$ease-out-quad, transform 0.25s var.$ease-out-quad;
}
.dropdown-float-neomorphic-enter-from,
.dropdown-float-neomorphic-leave-to {
  opacity: 0;
  transform: translateY(6px) scale(0.96);
}